"use strict";

const gpio = require("../gpio");

const INPUT_PIN = 21;
const OUTPUT_PIN = 20;
const DEBOUNCE_US = 1000; // us
const BLINK_TIME_MS = 500; // ms

// init pins 
// input must connect to ground for stop blink
gpio.init_gpio(INPUT_PIN, gpio.GPIO_MODE_INPUT_PULLUP, DEBOUNCE_US);
gpio.init_gpio(OUTPUT_PIN, gpio.GPIO_MODE_OUTPUT, 0);

// start blink loop
// blinks if input false
var loop_id = setInterval(() => {
    if (!gpio.get_gpio(INPUT_PIN))
        gpio.toggle_gpio(OUTPUT_PIN);
    else
        gpio.set_gpio(OUTPUT_PIN, 0);
}, BLINK_TIME_MS);

console.log("*** blink example ***");
console.log("output is pin", OUTPUT_PIN);
console.log("input pin", INPUT_PIN, "stops blinking when connected to ground");
console.log("stop program with Ctrl+C");

// handle Ctrl+C
process.on('SIGINT', () => {
    clearInterval(loop_id);
    gpio.set_gpio(OUTPUT_PIN, 0);
    gpio.deinit_gpio(INPUT_PIN);
    gpio.deinit_gpio(OUTPUT_PIN);
    console.log(" -> program stopped");
    process.exit();
});